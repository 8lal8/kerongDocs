## Общая структура ИС

Описание базовых концепций информационной системы Kerong.

## Аппаратное устройство системы

Основное назначение системы - управление доступом к шкафам, ячейкам и т.п., которые оснащаются постаматными замками:

![](/assets/Images/docs/locks.png)

Плата подает питание на замок, после чего срабатывает механизм, освобождающую ответную часть замка (крюк). Сами платы соединяются в единую последовательную цепь и могут управляться через сеть:

![](/assets/Images/docs/boardsConnection.png)

Помимо замков есть возможность подключать датчики обнаружения объектов, с помощью которых мы можем определять есть ли какой-то предмет в шкафу или нет.

## Разделы/Модули

Kerong Server подразделяется на разделы (или модули). Под разделами подразумевается логическое разделение функционала системы на выполняемые ими группы задач. Каждый раздел имеет свой уникальный идентификатор в рамках системы. Базовыми разделами являются:

![](/assets/Images/docs/sect.png)
* **Клиенты** -
Раздел отвечающий за взаимодействия с информацией по клиентам.
*  **Мониторинг** -
Раздел предоставляющий информацию о текущем состоянии системы. Под состоянием понимается статистическая информация по аренде, состояние плат и замков.
* **Настройки** -
Раздел предоставляющий функционал по настройке системы
* **Отчеты** -
Детализированная информация о состоянии системы, истории операций и т.д.

В свою очередь, у каждого раздела имеются подразделы. Подразделы хранятся в БД как и разделы, имеют уникальный идентификатор.

Подразделы раздела “Клиенты”:
1. Список клиентов
2. Карточка клиента

Подразделы раздела “Мониторинг”:
1. Страница мониторинга состояния системы по зонам.

Подразделы раздела “Настройки”:
1. Пользователи
2. Права доступа
3. Зоны
4. Платы управления
5. Kerong API
6. Замки

Подразделы раздела “Отчеты”:
1. Журнал событий
2. Бронирование замков
3. Детализация по клиентам
4. Детализация по замкам


## Клиенты

Клиент - потребительские пользователи системы по взаимодействию с заданным функционалом  программного комплекса по аренде ячеек (замков).
Форма “Список клиентов” отвечает за ведение и отображение всех заведенных клиентов в БД.


В списке клиента отображаются следующие данные по клиенту:
1. Фамилия
2. Имя
3. Отчество
4. Мобильный телефон
5. Дата рождения
6. Пол
7. Идентификаторы
8. Доступ к ячейкам/зоне

Формы имеет поле поиска по всем столбцам, фильтрации по всем столбцам. Заложен функционал Добавить, Изменить, Удалить(снятие флага активности, убрать из отображаемого списка).


При создании или изменении карточки клиента используется форма “Карточка клиента”.


Форма отображает поля ввода данных для перечисленных ранее сущностей Client. Обязательные поля для заполнения:


1. Фамилия
2. Имя
3. Мобильный телефон

Сущность Клиенты передается в отчетные формы.



## Пользователи

В разделе “Настройки” предусмотрен подраздел “Пользователи”.


Пользователи - административные пользователи по настройки, управлению программного комплекса по бронированию ячеек (замков)


Форма необходима для ведения учетных данных пользователей в БД и дальнейшего распределения по правам доступа по выбранным группам пользователей.
Предусматривает добавление, изменение, удаление(снятие флага активности, убрать из отображаемого списка).


Введена сущность “Группы пользователей” (Role). Каждый пользователь привязан к определенной группе для дальнейшего распределения по правам доступа.
По умолчанию добавлена административная группа с полными правами. Добавлен административный пользователь с группой администраторов.


## Права доступа

Права доступа - правила регламентирующие обращения пользователей к определенным данным в интерфейсе программного комплекса.


Разделение прав доступа предусмотрена по категориям:


1. Чтение
2. Запись
3. Редактирование
4. Удаление


По умолчанию для новых пользователей предусмотрена возможность выбора группы для наследования прав доступа из этой группы.

Работа разграничений прав доступа реализуется через присвоения определенных категорий на операции.

Например, для определенной группы пользователей выставляется настройка “Чтение” на определенные категории операций “Создание клиента” - Чтение. Для данной группы пользователей создание\редактирование будет не доступно. С формой можно взаимодействовать только для просмотра (чтения).   


## Логирование

Любая операция, которую совершает пользователь, фиксируется сервером. 

Под операцией подразумевается действия чтения, записи, редактирования и удаление информации в системе:

![](/assets/Images/docs/logs.png)

Операция классифицируется по типу (чтение, запись, редактирование, удаление) и по виду. Вид операции зависит от информационного раздела, где она совершается. Например, в разделе клиентов мы можем добавить клиента или изменить его ФИО, поэтому эти операции можно разделить на виды “Создание клиента” (тип операции - запись) и “Редактирование ФИО клиента”(тип операции - редактирование):

![](/assets/Images/docs/clients.png)

Каждому разделу (например, “Клиенты”) присваивается уникальный идентификатор и заранее определяется набор видов операций, которые хранятся в БД.

Каждая фиксируемая операция содержит в себе описание операции - автоматически генерируемый текст. Если тип операции “Редактирование”, то в описание заносится старая версия данных и новая, если “Удаление”, то ключевая информация из удаленных данных (зависит от раздела).

Каждый запрос к серверу подвергается логированию.


## Состояние замков и плат (Диагностика)

В Kerong Server инициализируется таймер, который через каждый свой тик делает запрос в Kerong API для получения статусов по всем платам, занесенным в систему. После получения ответа от Kerong API - результат обрабатывается и изменения вносятся в БД:

![](/assets/Images/docs/connect.png)

Инициализация таймера подразумевает под собой определение периода работы таймера - значение, задаваемое пользователем. По умолчанию 15 - 30 секунд.

Сущности, которые подвержены изменениям после обработки данных сервером:

* Замок
* BU-плата
* CU-плата

У замков может изменяться его **статус** (Открыт, закрыт), у плат - **состояние соединения** (Соединение установлено / не установлено). 

Во всех формах, где отображаются данные о замке или плате должно быть графическое отображение статуса или состояния соединения. В случае, если соединение отсутствует - отправка команд на открытие замков запрещается.

## Аренда

**Аренда** подразумевает бронь замка в определенной зоне клиентом на указанный период, например в фитнес-клубе, клиент оплачивает шкаф в личное пользование на какой-то период времени и только этот клиент имеет возможность взаимодействовать с этим шкафом в течении заданного периода. По истечении периода клиент больше **не может** взаимодействовать с этим шкафом (замком)

Для функционала аренда предусмотрены статусы аренды: **аренда** и **заблокировано**.

**Особенности:**
* Арендованный шкаф может быть закреплен и быть использован несколькими клиентами (например, если это родственники)
* После начала периода действия аренды статус аренды шкафа переходит в “Аренда”.
* На период аренды шкаф становится недоступен для других клиентов. Как только аренда заканчивается - статус замка переходит в “заблокировано” и требуются дополнительные действия со стороны пользователя для перевода статуса замка из этого состояния. Это необходимо для предварительной проверки шкафа прежде чем делать его доступным для других клиентов. 


Чтобы арендовать замок необходимы следующие обязательные параметры:
* **Номер замка (пользовательская нумерация)**
* **Фио клиента**
* **Телефон клиента**
* **Период аренды (начало даты/времени - конец даты/времени)**

_**Все обязательные параметры могут изменяться в любой период времени.**_

Чтобы следить за статусами арендованных шкафов - в разделе “Мониторинг” для каждой из зон предусмотрен список шкафов, статусы которых “аренда”.

![](/assets/Images/docs/rent.png)

## Режимы работы

В рамках ИС вводится два понятия, характеризующие режимы работы конкретного замка:
1. Публичный доступ
2. Частный доступ

Под публичным доступом подразумевается возможность использования шкафа любым из клиентов. Частный доступ - это закрепленный за определенным клиентом шкаф на некоторый или неограниченный период.

## Платы и зоны

### Зоны

Зоны предназначены для группировки плат KR-BU к которым подключены KR-CU платы. В рамках зоны можно установить пользовательскую нумерацию в определенных местах где установлены замки с платами.
Например, есть зона Мужская раздевалка. В эту зону устанавливаются порядковые номера, например,  150-425, количество ячеек и порядок нумерации в этой зоне будет регламентироваться подключенным к этой зоне плат KR-BU, а к ним KR-CU.
Основные разделы:
1. Наименование зоны
2. Количество ячеек
3. Нумерация

Возможен поиск по разделам.

Зоны отображаются в мониторинге.

Выбрав определенную зону можно провалиться в “карточку зоны” в которой можно увидеть более детальную информацию о зоне:

Наименование зоны, количество замков в зоне, нумерация замков, статус замков (открыт,закрыт), количество арендных замков в этой зоне, количество занятых арендных и свободных арендных замков.

Зоны можно добавлять, изменять, удалять.



## Платы

Основной раздел взаимодействия замков с платами и зонами, с которыми работает пользователь и клиент. В данном разделе заносится наименование зоны, которое создается в разделе Зоны, в эту зону заносится подключенная KR-BU плата и подключенные к ней KR-CU платы. Выставляется нумерация замков в соответствии с подключенными KR-CU платами. После подключения KR-BU, KR-CU и выставления нумерации замков на KR-CU плате, будет применяться единоразовая диагностика соединения с платами и замками (см. раздел Состояние замков и плат), также будет присутствовать кнопка Диагностика, которая при нажатии произведет диагностику всех подключенных плат занесенные в форму.

**Успешное соединение соответствует сообщению** - Подключено

**Неуспешное соединение соответствует сообщению** - Соединение отсутствует

Основные разделы:
* Зона
* Плата KR-BU
* Плата KR-CU
* Замки
* Статус



Есть возможность поиска по разделам

В данном разделе можно добавлять информацию, изменять, удалять.
